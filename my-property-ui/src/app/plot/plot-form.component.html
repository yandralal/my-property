<div class="group-box">
  <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
    <h2>Plot Sale Form</h2>
    <button class="modal-close" type="button" (click)="closeModalClicked()" aria-label="Close">&times;</button>
  </div>
  <form [formGroup]="plotForm" (ngSubmit)="onSubmit()" class="plot-form" autocomplete="off">
    <input type="hidden" formControlName="saleId" />
    <div class="form-sections">
      <div class="form-section">
        <div>
          <label for="plotNumber">Plot Number <span class="text-danger">*</span></label>
          <input id="plotNumber" formControlName="plotNumber" autocomplete="off" [disabled]="true"
            [class.is-invalid]="plotForm.get('plotNumber')?.invalid && plotForm.get('plotNumber')?.touched" />
          <div *ngIf="plotForm.get('plotNumber')?.invalid && plotForm.get('plotNumber')?.touched"
            class="invalid-feedback d-block">
            <span *ngIf="plotForm.get('plotNumber')?.errors?.['required']">Plot Number is required.</span>
          </div>
        </div>
        <div>
          <label for="status">Status <span class="text-danger">*</span></label>
          <select id="status" formControlName="status" [disabled]="true">
            <option value="">Select</option>
            <option value="Available">Available</option>
            <option value="Booked">Booked</option>
            <option value="Sold">Sold</option>
          </select>
        </div>
        <div>
          <label for="area">Area (sq.ft) <span class="text-danger">*</span></label>
          <input id="area" type="number" formControlName="area" [disabled]="true"
            [class.is-invalid]="plotForm.get('area')?.invalid && plotForm.get('area')?.touched" />
          <div *ngIf="plotForm.get('area')?.invalid && plotForm.get('area')?.touched" class="invalid-feedback d-block">
            <span *ngIf="plotForm.get('area')?.errors?.['required']">Area is required.</span>
            <span *ngIf="plotForm.get('area')?.errors?.['min']">Area must be greater than 0.</span>
          </div>
        </div>
        <div>
          <label for="saleAmount">Sale Amount <span class="text-danger">*</span></label>
          <input id="saleAmount" type="text" formControlName="saleAmount"
            [class.is-invalid]="plotForm.get('saleAmount')?.invalid && plotForm.get('saleAmount')?.touched" />
          <div *ngIf="plotForm.get('saleAmount')?.invalid && plotForm.get('saleAmount')?.touched"
            class="invalid-feedback d-block">
            <span *ngIf="plotForm.get('saleAmount')?.errors?.['required']">Sale Amount is required.</span>
            <span *ngIf="plotForm.get('saleAmount')?.errors?.['pattern']">Enter a valid amount.</span>
          </div>
        </div>
        <div>
          <label for="brokerAgent">Broker/Agent</label>
          <select id="agentId" formControlName="agentId">
            <option value="">Select Broker/Agent</option>
            <option *ngFor="let agent of agents" [value]="agent.id">{{ agent.name }}</option>
          </select>
        </div>
        <div>
          <label for="brokerageAmount">Brokerage Amount</label>
          <input id="brokerageAmount" type="text" formControlName="brokerageAmount"
            [class.is-invalid]="plotForm.get('brokerageAmount')?.invalid && plotForm.get('brokerageAmount')?.touched" />
          <div *ngIf="plotForm.get('brokerageAmount')?.invalid && plotForm.get('brokerageAmount')?.touched"
            class="invalid-feedback d-block">
            <span
              *ngIf="plotForm.get('brokerageAmount')?.errors?.['required'] && plotForm.get('agentId')?.value">Brokerage
              Amount is required if Broker/Agent is selected.</span>
            <span *ngIf="plotForm.get('brokerageAmount')?.errors?.['pattern']">Enter a valid amount.</span>
          </div>
        </div>
      </div>
      <div class="form-section">
        <div>
          <label for="customerName">Customer Name <span class="text-danger">*</span></label>
          <input id="customerName" formControlName="customerName" autocomplete="off"
            [class.is-invalid]="plotForm.get('customerName')?.invalid && plotForm.get('customerName')?.touched" />
          <div *ngIf="plotForm.get('customerName')?.invalid && plotForm.get('customerName')?.touched"
            class="invalid-feedback d-block">
            <span *ngIf="plotForm.get('customerName')?.errors?.['required']">Customer Name is required.</span>
          </div>
        </div>
        <div>
          <label for="customerPhone">Customer Phone <span class="text-danger">*</span></label>
          <input id="customerPhone" formControlName="customerPhone" autocomplete="off"
            maxlength="10"
            [class.is-invalid]="plotForm.get('customerPhone')?.invalid && plotForm.get('customerPhone')?.touched" />
          <div *ngIf="plotForm.get('customerPhone')?.invalid && plotForm.get('customerPhone')?.touched"
            class="invalid-feedback d-block">
            <span *ngIf="plotForm.get('customerPhone')?.errors?.['required']">Customer Phone is required.</span>
            <span *ngIf="plotForm.get('customerPhone')?.errors?.['pattern']">Enter a valid 10-digit phone number.</span>
          </div>
          <!-- Removed duplicate validation message for phone number -->
        </div>
        <div>
          <label for="customerEmail">Customer Email <span class="text-danger">*</span></label>
          <input id="customerEmail" formControlName="customerEmail" autocomplete="off"
            [class.is-invalid]="plotForm.get('customerEmail')?.invalid && plotForm.get('customerEmail')?.touched" />
          <div *ngIf="plotForm.get('customerEmail')?.invalid && plotForm.get('customerEmail')?.touched"
            class="invalid-feedback d-block">
            <span *ngIf="plotForm.get('customerEmail')?.errors?.['required']">Customer Email is required.</span>
            <span *ngIf="plotForm.get('customerEmail')?.errors?.['email']">Enter a valid email address.</span>
          </div>
        </div>
        <div>
          <label for="saleDate">Sale Date <span class="text-danger">*</span></label>
          <input id="saleDate" type="date" formControlName="saleDate"
            [class.is-invalid]="plotForm.get('saleDate')?.invalid && plotForm.get('saleDate')?.touched" />
          <div *ngIf="plotForm.get('saleDate')?.invalid && plotForm.get('saleDate')?.touched"
            class="invalid-feedback d-block">
            <span *ngIf="plotForm.get('saleDate')?.errors?.['required']">Sale Date is required.</span>
          </div>
        </div>
      </div>
    </div>
    <button type="submit" class="btn btn-primary" [disabled]="!viewMode && plotForm.invalid">{{ viewMode ? 'Close' : 'Save' }}</button>
  </form>
</div>