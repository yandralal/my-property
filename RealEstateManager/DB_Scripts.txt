IF OBJECT_ID('dbo.MiscTransaction', 'U') IS NOT NULL DROP TABLE dbo.MiscTransaction;
IF OBJECT_ID('dbo.PropertyTransaction', 'U') IS NOT NULL DROP TABLE dbo.PropertyTransaction;
IF OBJECT_ID('dbo.PlotTransaction', 'U') IS NOT NULL DROP TABLE dbo.PlotTransaction;
IF OBJECT_ID('dbo.AgentTransaction', 'U') IS NOT NULL DROP TABLE dbo.AgentTransaction;
IF OBJECT_ID('dbo.PropertyLoanTransaction', 'U') IS NOT NULL DROP TABLE dbo.PropertyLoanTransaction;
IF OBJECT_ID('dbo.PlotSale', 'U') IS NOT NULL DROP TABLE dbo.PlotSale;
IF OBJECT_ID('dbo.Plot', 'U') IS NOT NULL DROP TABLE dbo.Plot;
IF OBJECT_ID('dbo.PropertyLoan', 'U') IS NOT NULL DROP TABLE dbo.PropertyLoan;
IF OBJECT_ID('dbo.Agent', 'U') IS NOT NULL DROP TABLE dbo.Agent;
IF OBJECT_ID('dbo.Property', 'U') IS NOT NULL DROP TABLE dbo.Property;
IF OBJECT_ID('dbo.Login', 'U') IS NOT NULL DROP TABLE dbo.Login;

CREATE TABLE Login (
    UserID INT PRIMARY KEY,
    UserName NVARCHAR(50) NOT NULL UNIQUE,
    PasswordHash NVARCHAR(255) NOT NULL,
    FirstName NVARCHAR(100) NOT NULL,
    LastName NVARCHAR(100) NOT NULL,
    Email NVARCHAR(255) NOT NULL,
    MobileNo NVARCHAR(20) NOT NULL,
    Role NVARCHAR(50) NOT NULL,
    IsActive BIT NOT NULL,
    BackgroundColor NVARCHAR(20) NULL
);

INSERT INTO [Login] (UserID, UserName, PasswordHash, FirstName, LastName, Email, MobileNo, Role, IsActive)
VALUES (1, 'admin', 'admin', 'Yandralal', 'Thakre', 'yandralal@live.com', '9637151024', 'Admin', 1);

CREATE TABLE Property (
    Id INT IDENTITY(1,1) PRIMARY KEY,
    Title NVARCHAR(255) NOT NULL,
    Type NVARCHAR(100) NOT NULL,
    Status NVARCHAR(100) NOT NULL,
    Price DECIMAL(18,2) NOT NULL,
    Owner NVARCHAR(255) NOT NULL,
    KhasraNo NVARCHAR(100) NULL,
    Area DECIMAL(18,2) NOT NULL,
    Phone NVARCHAR(20) NOT NULL,
    Address NVARCHAR(255) NULL,
    City NVARCHAR(100) NULL,
    State NVARCHAR(100) NULL,
    ZipCode NVARCHAR(20) NULL,
    Description NVARCHAR(MAX) NULL,
    CreatedBy NVARCHAR(255) NOT NULL,
    CreatedDate DATETIME NOT NULL,
    ModifiedBy NVARCHAR(255) NOT NULL,
    ModifiedDate DATETIME NOT NULL,
    IsDeleted BIT NOT NULL DEFAULT 0
);


CREATE TABLE Plot (
	Id INT IDENTITY PRIMARY KEY,
	PropertyId INT NOT NULL,
    PlotNumber NVARCHAR(50) NOT NULL,
    Area DECIMAL(18,2) NOT NULL,
    Status NVARCHAR(50) NOT NULL,
    CreatedBy NVARCHAR(255) NOT NULL,
    CreatedDate DATETIME NOT NULL,
    ModifiedBy NVARCHAR(255) NOT NULL,
    ModifiedDate DATETIME NOT NULL,
    IsDeleted BIT NOT NULL DEFAULT 0,
	FOREIGN KEY (PropertyId) REFERENCES Property(Id)
);

CREATE TABLE PlotSale (
    SaleId INT IDENTITY PRIMARY KEY,
    PropertyId INT NOT NULL,
    PlotId INT NULL,
    CustomerName NVARCHAR(100) NOT NULL,
    CustomerPhone NVARCHAR(20) NOT NULL,
    CustomerEmail NVARCHAR(100) NULL,
    SaleAmount DECIMAL(18,2) NOT NULL,
    SaleDate DATETIME NOT NULL,
    AgentId INT NULL,
    BrokerageAmount DECIMAL(18,2) NULL,
    CreatedBy NVARCHAR(255) NOT NULL,
    CreatedDate DATETIME NOT NULL,
    ModifiedBy NVARCHAR(255) NOT NULL,
    ModifiedDate DATETIME NOT NULL,
    IsDeleted BIT NOT NULL DEFAULT 0,
    FOREIGN KEY (PropertyId) REFERENCES Property(Id),
    FOREIGN KEY (PlotId) REFERENCES Plot(Id)
);

CREATE TABLE PlotTransaction (
    TransactionId INT IDENTITY(1,1) PRIMARY KEY,
    PlotId INT NOT NULL,
    TransactionDate DATETIME NOT NULL DEFAULT GETDATE(),
    TransactionType NVARCHAR(10) NOT NULL,
    Amount DECIMAL(18,2) NOT NULL,
    PaymentMethod NVARCHAR(50) NULL,
    ReferenceNumber NVARCHAR(100) NULL,
    Notes NVARCHAR(500) NULL,
    CreatedBy NVARCHAR(100) NULL,
    CreatedDate DATETIME NOT NULL DEFAULT GETDATE(),
    ModifiedBy NVARCHAR(100) NULL,
    ModifiedDate DATETIME NULL,
    IsDeleted BIT NOT NULL DEFAULT 0,
    FOREIGN KEY (PlotId) REFERENCES Plot(Id)
);

CREATE TABLE [dbo].[PropertyTransaction](
	[TransactionId] [int] IDENTITY(1,1) PRIMARY KEY,
	[PropertyId] [int] NOT NULL,
	[TransactionDate] [datetime] NOT NULL,
	[Amount] [decimal](18, 2) NOT NULL,
	[PaymentMethod] [nvarchar](50) NULL,
	[ReferenceNumber] [nvarchar](100) NULL,
	[TransactionType] [nvarchar](10) NOT NULL,
	[Notes] [nvarchar](500) NULL,
	[CreatedBy] [nvarchar](100) NULL,
	[CreatedDate] [datetime] NOT NULL,
	[ModifiedBy] [nvarchar](100) NULL,
	[ModifiedDate] [datetime] NULL,
	IsDeleted BIT NOT NULL DEFAULT 0,
    FOREIGN KEY (PropertyId) REFERENCES Property(Id)
)

CREATE TABLE Agent (
    Id INT IDENTITY(1,1) PRIMARY KEY,
    Name NVARCHAR(100) NOT NULL,
    Contact NVARCHAR(50),
    Agency NVARCHAR(100),
    IsDeleted BIT NOT NULL DEFAULT 0,
    CreatedBy NVARCHAR(255) NOT NULL,
    CreatedDate DATETIME NOT NULL,
    ModifiedBy NVARCHAR(255) NOT NULL,
    ModifiedDate DATETIME NOT NULL
);

CREATE TABLE [dbo].[AgentTransaction] (
    [TransactionId] INT IDENTITY(1,1) PRIMARY KEY,
    [AgentId] INT NOT NULL,
    [PlotId] INT NULL,
    [PropertyId] INT NOT NULL,
    [TransactionDate] DATETIME NOT NULL DEFAULT GETDATE(),
    [Amount] DECIMAL(18,2) NOT NULL,
    [PaymentMethod] NVARCHAR(50) NULL,
    [ReferenceNumber] NVARCHAR(100) NULL,
    [TransactionType] NVARCHAR(10) NOT NULL,
    [Notes] NVARCHAR(500) NULL,
    [CreatedBy] NVARCHAR(100) NULL,
    [CreatedDate] DATETIME NOT NULL DEFAULT GETDATE(),
    [ModifiedBy] NVARCHAR(100) NULL,
    [ModifiedDate] DATETIME NULL,
    [IsDeleted] BIT NOT NULL DEFAULT 0,
    FOREIGN KEY ([AgentId]) REFERENCES [Agent]([Id]),
    FOREIGN KEY ([PlotId]) REFERENCES [Plot]([Id]),
    FOREIGN KEY (PropertyId) REFERENCES Property(Id)
);

CREATE TABLE [dbo].[MiscTransaction] (
    [TransactionId]     INT IDENTITY(1,1) PRIMARY KEY,
    [TransactionDate]   DATETIME      NOT NULL,
    [Amount]            DECIMAL(18,2) NOT NULL,
    [PaymentMethod]     NVARCHAR(50)  NULL,
    [ReferenceNumber]   NVARCHAR(100) NULL,
    [Recipient]         NVARCHAR(200) NULL,
    [Notes]             NVARCHAR(500) NULL,
    [TransactionType]   NVARCHAR(20)  NOT NULL,
    [CreatedBy]         NVARCHAR(100) NOT NULL,
    [CreatedDate]       DATETIME      NOT NULL,
    [ModifiedBy]        NVARCHAR(100) NULL,
    [ModifiedDate]      DATETIME      NULL,
    [IsDeleted]         BIT           NOT NULL DEFAULT 0
);

CREATE TABLE PropertyLoan (
    Id INT IDENTITY PRIMARY KEY,
    PropertyId INT NOT NULL,
    LoanAmount DECIMAL(18,2) NOT NULL,
    LenderName NVARCHAR(100) NOT NULL,
    InterestRate DECIMAL(5,2) NOT NULL,
	Tenure INT NOT NULL,
    TotalInterest DECIMAL(18,2) NULL,
    TotalRepayment DECIMAL(18,2) NULL,
    LoanDate DATETIME NOT NULL,
    Remarks NVARCHAR(255) NULL,
    CreatedDate DATETIME NOT NULL DEFAULT GETDATE(),
    CreatedBy NVARCHAR(100) NULL,
    ModifiedBy NVARCHAR(100) NULL,
    ModifiedDate DATETIME NULL,
    IsDeleted BIT NOT NULL DEFAULT 0,
    CONSTRAINT FK_PropertyLoan_Property FOREIGN KEY (PropertyId) REFERENCES Property(Id)
);

CREATE TABLE PropertyLoanTransaction (
    Id INT IDENTITY(1,1) PRIMARY KEY,
    PropertyId INT NOT NULL,
    PropertyLoanId INT NULL,
    LenderName NVARCHAR(200) NOT NULL,
    PrincipleAmount DECIMAL(18,2) NOT NULL DEFAULT 0,   -- Amount paid towards Principle
    InterestAmount DECIMAL(18,2) NOT NULL DEFAULT 0,    -- Amount paid towards interest
    TransactionType NVARCHAR(50) NOT NULL,              -- "Principle" or "Interest"
    TransactionDate DATETIME NOT NULL,
    PaymentMethod NVARCHAR(100) NOT NULL,
    ReferenceNumber NVARCHAR(100) NULL,
    Notes NVARCHAR(500) NULL,
    CreatedDate DATETIME NOT NULL,
    CreatedBy NVARCHAR(100) NULL,
    ModifiedDate DATETIME NULL,
    ModifiedBy NVARCHAR(100) NULL,
    IsDeleted BIT NOT NULL DEFAULT 0
);