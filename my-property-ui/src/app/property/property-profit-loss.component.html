<div class="group-box">
  <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
    <h2><i class="bi bi-graph-up-arrow" style="margin-right: 0.5rem;"></i>Property Profit/Loss Summary</h2>
    <button class="modal-close" type="button" (click)="onClose()" aria-label="Close">&times;</button>
  </div>

  <div *ngIf="!property" class="no-data-message">
    <i class="bi bi-info-circle"></i>
    <p>Select a property to view profit/loss summary.</p>
  </div>

  <div *ngIf="property" class="summary-content">
    <!-- Financial Details Section -->
    <div class="financial-section">
      <h3 class="section-title"><i class="bi bi-cash-stack"></i> Financial Details</h3>
      <div class="financial-grid">
        <div class="financial-card">
          <div class="card-label">Buy Price</div>
          <div class="card-value"><i class="bi bi-currency-rupee"></i>{{ buyValue | number:'1.0-0' }}/-</div>
        </div>
        <div class="financial-card">
          <div class="card-label">Amount Paid (Cash)</div>
          <div class="card-value"><i class="bi bi-currency-rupee"></i>{{ amountPaidCash | number:'1.0-0' }}/-</div>
        </div>
        <div class="financial-card">
          <div class="card-label">Amount Paid (Loan)</div>
          <div class="card-value"><i class="bi bi-currency-rupee"></i>{{ totalLoanPrinciple | number:'1.0-0' }}/-</div>
        </div>
        <div class="financial-card">
          <div class="card-label">Property Balance</div>
          <div class="card-value warning"><i class="bi bi-currency-rupee"></i>{{ propertyBalance | number:'1.0-0' }}/-</div>
        </div>
      </div>
    </div>

    <!-- Plots Summary Section -->
    <div class="plots-section">
      <h3 class="section-title"><i class="bi bi-geo-alt"></i> Plots Summary</h3>
      <div class="plots-grid">
        <div class="stat-card">
          <div class="stat-icon"><i class="bi bi-grid-3x3"></i></div>
          <div class="stat-content">
            <div class="stat-label">Total Plots</div>
            <div class="stat-value">{{ totalPlots }}</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon sold"><i class="bi bi-check-circle"></i></div>
          <div class="stat-content">
            <div class="stat-label">Plots Sold</div>
            <div class="stat-value">{{ totalPlotsSold }}</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon available"><i class="bi bi-circle"></i></div>
          <div class="stat-content">
            <div class="stat-label">Available</div>
            <div class="stat-value">{{ totalPlots - totalPlotsSold }}</div>
          </div>
        </div>
      </div>

      <div class="financial-grid" style="margin-top: 1rem;">
        <div class="financial-card">
          <div class="card-label">Total Sale Amount</div>
          <div class="card-value"><i class="bi bi-currency-rupee"></i>{{ totalPlotsSaleAmount | number:'1.0-0' }}/-</div>
        </div>
        <div class="financial-card">
          <div class="card-label">Total Received</div>
          <div class="card-value success"><i class="bi bi-currency-rupee"></i>{{ totalPlotsPaid | number:'1.0-0' }}/-</div>
        </div>
        <div class="financial-card">
          <div class="card-label">Total Balance</div>
          <div class="card-value warning"><i class="bi bi-currency-rupee"></i>{{ totalPlotsBalance | number:'1.0-0' }}/-</div>
        </div>
        <div class="financial-card">
          <div class="card-label">Total Brokerage</div>
          <div class="card-value"><i class="bi bi-currency-rupee"></i>{{ totalBrokerage | number:'1.0-0' }}/-</div>
        </div>
      </div>
    </div>

    <div class="loan-section">
      <h3 class="section-title"><i class="bi bi-bank"></i> Loan Summary</h3>
      <div class="financial-grid">
        <div class="financial-card">
          <div class="card-label">Total Loan Principle</div>
          <div class="card-value"><i class="bi bi-currency-rupee"></i>{{ totalLoanPrinciple | number:'1.0-0' }}/-</div>
        </div>
        <div class="financial-card">
          <div class="card-label">Total Loan Interest</div>
          <div class="card-value"><i class="bi bi-currency-rupee"></i>{{ totalLoanInterest | number:'1.0-0' }}/-</div>
        </div>
      </div>
    </div>

    <!-- Profit/Loss Section (KPIs + Charts + Realized/Unrealized) -->
    <div class="profit-loss-section">
      <h3 class="section-title"><i class="bi bi-graph-up-arrow"></i> Profit / Loss</h3>

      <!-- Net Profit/Loss Highlight Card -->
      <div class="net-profit-loss-card">
        <div class="card-label">Net Profit / Loss</div>
        <div 
          class="card-value net-profit-loss-value"
          [style.color]="profitLossAfterLoan < 0 ? '#dc2626 !important' : '#059669 !important'"
        >
          <i class="bi bi-currency-rupee"></i>{{ (profitLossAfterLoan < 0 ? -profitLossAfterLoan : profitLossAfterLoan) | number:'1.0-0' }}/-
        </div>
        <div class="card-sub formula-sub">
          <span class="formula-label">(Total Cost - Total Sale Amount)</span>
        </div>
      </div>

      <div class="pl-main">
        <!-- Small inline stacked bar chart (Received | Costs | Receivable) -->
        <div class="pl-chart-card" style="width:100%">
          <div class="card-label">Composition</div>
          <div class="pl-chart" aria-hidden="true">
            <div class="bar">
              <div class="segment received" [attr.title]="getSegmentTitle('received')" [style.width.%]="(realizedReceived + 0) && (realizedReceived + realizedCosts + unrealizedReceivable) > 0 ? (realizedReceived / (realizedReceived + realizedCosts + unrealizedReceivable) * 100) : 0"></div>
              <div class="segment costs" [attr.title]="getSegmentTitle('costs')" [style.width.%]="(realizedCosts + 0) && (realizedReceived + realizedCosts + unrealizedReceivable) > 0 ? (realizedCosts / (realizedReceived + realizedCosts + unrealizedReceivable) * 100) : 0"></div>
              <div class="segment receivable" [attr.title]="getSegmentTitle('receivable')" [style.width.%]="(unrealizedReceivable + 0) && (realizedReceived + realizedCosts + unrealizedReceivable) > 0 ? (unrealizedReceivable / (realizedReceived + realizedCosts + unrealizedReceivable) * 100) : 0"></div>
            </div>
            <div class="legend">
              <span><i class="legend-box received"></i>Received</span>
              <span><i class="legend-box costs"></i>Costs</span>
              <span><i class="legend-box receivable"></i>Receivable</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
