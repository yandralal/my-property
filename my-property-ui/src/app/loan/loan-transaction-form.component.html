<div class="group-box">
  <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
    <h2>Loan Transaction Form</h2>
    <button class="modal-close" type="button" (click)="onCancel()" aria-label="Close">&times;</button>
  </div>
  <form [formGroup]="loanTransactionForm" (ngSubmit)="onSubmit()" class="loan-transaction-form" autocomplete="off">
    <div class="form-sections">
      <div class="form-section">
        <div>
          <label for="property">Property <span style="color:red">*</span></label>
          <input id="property" formControlName="property" readonly/>
        </div>

        <div>
          <label for="lenderName">Lender Name <span style="color:red">*</span></label>
          <input id="lenderName" formControlName="lenderName" readonly/>
        </div>

        <div>
          <label for="loanAmount">Loan Amount</label>
          <input id="loanAmount" formControlName="loanAmount" readonly />
        </div>
        
        <div>
          <label for="payingFor">Paying For <span style="color:red">*</span></label>
          <select id="payingFor" formControlName="payingFor">
            <option value="Interest">Interest</option>
            <option value="Principle">Principle</option>
          </select>
        </div>
        
        <ng-container *ngIf="loanTransactionForm.get('payingFor')?.value === 'Interest'">
          <div>
            <label for="totalInterest">Total Interest</label>
            <input id="totalInterest" formControlName="totalInterest" readonly />
          </div>
          <div>
            <label for="totalInterestPaid">Total Interest Paid</label>
            <input id="totalInterestPaid" formControlName="totalInterestPaid" readonly />
          </div>
        </ng-container>

        <ng-container *ngIf="loanTransactionForm.get('payingFor')?.value === 'Principle'">
          <div> <label for="totalPrinciple">Total Principle</label>
            <input id="totalPrinciple" formControlName="totalPrinciple" readonly />
          </div>
          <div>
            <label for="totalPrinciplePaid">Total Principle Paid</label>
            <input id="totalPrinciplePaid" formControlName="totalPrinciplePaid" readonly />
          </div>
        </ng-container>

        <div>
          <label for="balance">Outstanding Balance</label>
          <input id="balance" formControlName="balance" readonly />
        </div>
      </div>
      <div class="form-section">
        <div>
          <label for="transactionDate">Transaction Date <span style="color:red">*</span></label>
          <input id="transactionDate" type="date" formControlName="transactionDate" />
        </div>

        <div>
          <label for="amount">Transaction Amount <span style="color:red">*</span></label>
          <input id="amount" formControlName="amount" />
          <div *ngIf="loanTransactionForm.get('amount')?.hasError('exceedsOutstanding') && loanTransactionForm.get('amount')?.touched" 
               class="invalid-feedback" style="display: block; margin-top: 0.25rem;">
            Transaction amount cannot exceed the outstanding balance.
          </div>
          <div *ngIf="loanTransactionForm.get('amount')?.hasError('exceedsInterest') && loanTransactionForm.get('amount')?.touched" 
               class="invalid-feedback" style="display: block; margin-top: 0.25rem;">
            Transaction amount cannot exceed remaining interest to be paid.
          </div>
          <div *ngIf="loanTransactionForm.get('amount')?.hasError('exceedsPrincipal') && loanTransactionForm.get('amount')?.touched" 
               class="invalid-feedback" style="display: block; margin-top: 0.25rem;">
            Transaction amount cannot exceed remaining principal to be paid.
          </div>
        </div>
        
        <div>
          <label for="transactionType">Transaction Type <span style="color:red">*</span></label>
          <select id="transactionType" formControlName="transactionType">
            <option value="">Select</option>
            <option *ngFor="let type of transactionTypes" [value]="type">{{ type }}</option>
          </select>
        </div>

        <div>
          <label for="paymentMethod">Payment Method <span style="color:red">*</span></label>
          <select id="paymentMethod" formControlName="paymentMethod">
            <option value="">Select</option>
            <option value="Cash">Cash</option>
            <option value="Cheque">Cheque</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <div>
          <label for="referenceNumber">Reference Number</label>
          <input id="referenceNumber" formControlName="referenceNumber" />
        </div>

        <div>
          <label for="notes">Remarks</label>
          <textarea id="notes" formControlName="notes" rows="3"></textarea>
        </div>
      </div>
    </div>
    <div style="display: flex; justify-content: flex-end;">
      <button type="submit" class="btn btn-primary" [disabled]="loanTransactionForm.invalid">Save</button>
    </div>
  </form>
</div>